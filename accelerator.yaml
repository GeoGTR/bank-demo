accelerator:
  displayName: Tanzu Banking Demo
  description: Accelerator to demonstate banking application on TAP with microservices
  iconUrl: https://upload.wikimedia.org/wikipedia/commons/thumb/d/d9/Node.js_logo.svg/1280px-Node.js_logo.svg.png
  tags:
  - spring
  - banking
  - tanzu-banking-demo

  options:
  
         
  - name: gitRepo
    label: Git repo
    inputType: text
    required: true
    dataType: string
    defaultValue: https://github.com/MoSehsah/bank-demo
    
  - name: parentApp
    label: Name of parent application (the Big A app)
    description: Name of the parent application this component is a part of
    inputType: text
    dataType: string
    defaultValue: banking-demo

  - name: namespaceToDeploy
    label: Namespace to deploy
    description: Please type the namespace to deploy
    inputType: text
    dataType: string
    defaultValue: dev

  - name: wavefrontToken
    label: Tanzu Observability Token for distributed tracing
    description: Please type the token
    inputType: text
    dataType: string
    defaultValue: xyz-asd-000

  #config-server
  - name: configServerDeploy
    label: Deploy Config-Server ?
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false

  - name: branchNameConfigServer
    label: Branch of the Config-Server
    description: Please type the branch to use - Skip this value if using existing.
    dependsOn:
      name: configServerDeploy
    inputType: text
    dataType: string
    defaultValue: main
####################################################################################################################################
  #account-service
  - name: accountServiceDeploy
    label: Deploy Account-Service ?
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name: accountServiceDeployState
    label: Choose Account-Service
    dependsOn:
      name: accountServiceDeploy
    inputType: select
    defaultValue: newAccountServiceDevelop
    choices:
      - value: newAccountServiceDevelop
        text: Develop from source code
      - value: newAccountServiceDeploy
        text: Deploy only
      - value: existingAccountService
        text: Use Existing
  - name: accountServiceDeployName
    label: Choose service name of Account-Service.
    describe: Change default value if needed
    dependsOn:
      name: accountServiceDeploy
    inputType: text
    dataType: string
    defaultValue: account-service # double check.

  - name: hasTestsAccountService
    label: Do CI test
    dependsOn:
      name: accountServiceDeploy
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false

  - name: branchNameAccountService
    label: Branch of the Account-Service
    description: Please type the branch to use - Skip this value if using existing.
    dependsOn:
      name: accountServiceDeploy
    inputType: text
    dataType: string
    defaultValue: main
####################################################################################################################################
  #user-service
  - name: userServiceDeploy
    label: Deploy User-Service ?
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name: userServiceDeployState
    label: Choose User-Service
    dependsOn:
      name: userServiceDeploy
    inputType: select
    defaultValue: newUserServiceDevelop
    choices:
      - value: newUserServiceDevelop
        text: Develop from source code
      - value: newUserServiceDeploy
        text: Deploy only
      - value: existingUserService
        text: Use Existing
  - name: userServiceDeployName
    label: Choose service name of User-Service.
    describe: Change default value if needed
    dependsOn:
      name: userServiceDeploy
    inputType: text
    dataType: string
    defaultValue: user-service # double check.

  - name: hasTestsUserService
    label: Do CI test
    dependsOn:
      name: userServiceDeploy
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false

  - name: branchNameUserService
    label: Branch of the User-Service
    description: Please type the branch to use - Skip this value if using existing.
    dependsOn:
      name: userServiceDeploy
    inputType: text
    dataType: string
    defaultValue: main
####################################################################################################################################
  #quote-service
  - name: quoteServiceDeploy
    label: Deploy Quote-Service ?
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name:  quoteServiceDeployState
    label: Choose Quote-Service
    dependsOn:
      name: quoteServiceDeploy
    inputType: select
    defaultValue: newQuoteServiceDevelop
    choices:
      - value: newQuoteServiceDevelop
        text: Develop from source code
      - value: newQuoteServiceDeploy
        text: Deploy only
      - value: existingQuoteService
        text: Use Existing
  - name: quoteServiceDeployName
    label: Choose service name of Quote-Service.
    describe: Change default value if needed
    dependsOn:
      name: quoteServiceDeploy
    inputType: text
    dataType: string
    defaultValue: quote-service # double check.

  - name: hasTestsQuoteService
    label: Do CI test
    dependsOn:
      name: quoteServiceDeploy
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false

  - name: branchNameQuoteService
    label: Branch of the Quote-Service
    description: Please type the branch to use - Skip this value if using existing.
    dependsOn:
      name: quoteServiceDeploy
    inputType: text
    dataType: string
    defaultValue: main
####################################################################################################################################
#  - name: You can access the output with CLI as well
#    inputType: textarea
#    display: true
#    defaultValue: |
#      kubectl -n accelerator-system port-forward svc/acc-server 8877:80
#      tanzu accelerator generate spring-data-services --server-url http://localhost:8877 --options='{"gitRepo":"https://github.com/gorkemozlu/spring-petclinic-tap-mysql","parentApp":"petclinic-app","hasTests":false,"addToComponent":true,"branchName":"main","namespaceToDeploy":"my-apps","addDB":true,"dbType":"MySQL","dbName":"petclinic-db","appDeploymentType":"tap"}'

engine:
  merge:
    #generic transformations
    - includes: ["account-service/**"]
      condition: "#accountServiceDeployState == 'newAccountServiceDevelop'"
      excludes: [ "account-service/target","account-service/config/**" ]
    - includes: ["account-service/config/**"]
      condition: "#accountServiceDeploy != ''"
      chain:
        - type: YTT
    - includes: ["config-server/config/**"]
      condition: "#configServerDeploy != ''"
      chain:
        - type: YTT
    - includes: ["user-service/**"]
      condition: "#userServiceDeployState == 'newUserServiceDevelop'"
      excludes: [ "user-service/target","user-service/config/**" ]
    - includes: ["user-service/config/**"]
      condition: "#userServiceDeploy != ''"
      chain:
        - type: YTT
    - includes: ["quote-service/**"]
      condition: "#quoteServiceDeployState == 'newQuoteServiceDevelop'"
      excludes: [ "quote-service/target","quote-service/config/**" ]
    - includes: ["quote-service/config/**"]
      condition: "#quoteServiceDeploy != ''"
      chain:
        - type: YTT
      #chain:
      #  - type: ReplaceText
      #    substitutions:
      #      - text: app-name
      #        with: "#parentApp"


    #data entity transformations
#    - includes: [ "src/main/resources/application.properties" ]
#      condition: "#dbType != ''"
#      chain:
#        - type: ReplaceText
#          substitutions:
#            - text: petclinic-app-mysql-claim
#              with: "#parentApp+'-'+#dbType+'-claim'"
#    - includes: [ "Tiltfile" ]
#      chain:
#        - type: ReplaceText
#          substitutions:
#            - text: app-name
#              with: "#parentApp"
#        - type: ReplaceText
#          substitutions:
#            - text: nspace
#              with: "#namespaceToDeploy"